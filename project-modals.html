<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Modal System</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <style>
        /* ===== PROJECT MODAL STYLES ===== */
        
        /* Base Modal Structure */
        .project-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 200ms ease;
            backdrop-filter: blur(4px);
        }

        .project-modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .project-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.95);
            width: 95vw;
            max-width: 1400px;
            height: 90vh;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            transition: transform 200ms ease;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .project-modal-overlay.active .project-modal {
            transform: translate(-50%, -50%) scale(1);
        }

        /* Corner Cut for Brand Continuity */
        .project-modal::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 40px;
            height: 40px;
            background: linear-gradient(-45deg, transparent 50%, white 50%);
            z-index: 1;
        }

        /* Header */
        .project-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 24px 32px;
            border-bottom: 1px solid #e5e5e5;
            background: white;
            position: relative;
            z-index: 2;
        }

        .project-modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1a1a1a;
            margin: 0;
        }

        .project-modal-badges {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .project-badge {
            background: #f3f4f6;
            color: #6b7280;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .project-badge.scenario {
            background: #fef3c7;
            color: #92400e;
        }

        .project-badge.synthetic {
            background: #dbeafe;
            color: #1e40af;
        }

        .project-modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #6b7280;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 150ms ease;
        }

        .project-modal-close:hover {
            background: #f3f4f6;
            color: #1a1a1a;
        }

        /* Main Content Layout */
        .project-modal-content {
            display: flex;
            height: calc(100% - 80px);
        }

        .project-modal-main {
            flex: 1;
            padding: 32px;
            overflow-y: auto;
            scroll-behavior: smooth;
        }

        .project-modal-sidebar {
            width: 320px;
            background: #fafafa;
            border-left: 1px solid #e5e5e5;
            overflow-y: auto;
            position: sticky;
            top: 0;
        }

        /* Navigation Sections */
        .project-section {
            margin-bottom: 40px;
            scroll-margin-top: 20px;
        }

        .project-section-title {
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: #6b7280;
            margin-bottom: 16px;
            padding-top: 24px;
            border-top: 1px solid #e5e5e5;
        }

        .project-section:first-child .project-section-title {
            border-top: none;
            padding-top: 0;
        }

        .project-section-content {
            line-height: 1.6;
            color: #4b5563;
        }

        /* Sidebar Components */
        .sidebar-section {
            padding: 24px;
            border-bottom: 1px solid #e5e5e5;
        }

        .sidebar-section:last-child {
            border-bottom: none;
        }

        .sidebar-title {
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 16px;
            font-size: 0.9rem;
        }

        /* Contents Navigation */
        .contents-nav {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .contents-nav li {
            margin-bottom: 8px;
        }

        .contents-nav a {
            color: #6b7280;
            text-decoration: none;
            font-size: 0.875rem;
            padding: 4px 0;
            display: block;
            transition: color 150ms ease;
        }

        .contents-nav a:hover,
        .contents-nav a.active {
            color: #1a1a1a;
        }

        /* Controls */
        .scenario-controls {
            margin-bottom: 20px;
        }

        .scenario-chips {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .scenario-chip {
            background: white;
            border: 1px solid #d1d5db;
            color: #6b7280;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 150ms ease;
        }

        .scenario-chip.active {
            background: #1a1a1a;
            color: white;
            border-color: #1a1a1a;
        }

        .parameter-control {
            margin-bottom: 16px;
        }

        .parameter-label {
            font-size: 0.875rem;
            color: #4b5563;
            margin-bottom: 8px;
            display: block;
        }

        .parameter-slider {
            width: 100%;
            -webkit-appearance: none;
            appearance: none;
            height: 4px;
            background: #e5e7eb;
            border-radius: 2px;
            outline: none;
        }

        .parameter-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            background: #1a1a1a;
            border-radius: 50%;
            cursor: pointer;
        }

        /* Quick Facts */
        .quick-facts {
            display: grid;
            gap: 12px;
        }

        .quick-fact {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.875rem;
        }

        .quick-fact-label {
            color: #6b7280;
        }

        .quick-fact-value {
            color: #1a1a1a;
            font-weight: 500;
        }

        /* Chart Containers */
        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 24px;
            margin: 24px 0;
        }

        .chart-tile {
            background: white;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            padding: 20px;
            position: relative;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .chart-title {
            font-family: 'SÃ¶hne Mono', monospace;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: #1a1a1a;
        }

        .chart-menu {
            background: none;
            border: none;
            color: #6b7280;
            cursor: pointer;
            font-size: 1rem;
            padding: 4px;
            border-radius: 4px;
            transition: background 150ms ease;
        }

        .chart-menu:hover {
            background: #f3f4f6;
        }

        .chart-container {
            height: 200px;
            margin-bottom: 12px;
        }

        .chart-takeaway {
            font-size: 0.875rem;
            color: #6b7280;
            line-height: 1.4;
        }

        /* Impact Stats */
        .impact-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin: 24px 0;
        }

        .impact-stat {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 16px;
            text-align: center;
        }

        .impact-stat-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 4px;
        }

        .impact-stat-label {
            font-size: 0.75rem;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Attachments */
        .attachments-grid {
            display: grid;
            gap: 12px;
        }

        .attachment-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: white;
            border: 1px solid #e5e5e5;
            border-radius: 6px;
            cursor: pointer;
            transition: all 150ms ease;
        }

        .attachment-item:hover {
            background: #f9fafb;
            border-color: #d1d5db;
        }

        .attachment-icon {
            width: 32px;
            height: 32px;
            background: #f3f4f6;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            color: #6b7280;
        }

        .attachment-info {
            flex: 1;
        }

        .attachment-name {
            font-size: 0.875rem;
            font-weight: 500;
            color: #1a1a1a;
            margin-bottom: 2px;
        }

        .attachment-meta {
            font-size: 0.75rem;
            color: #6b7280;
        }

        /* Footer */
        .project-modal-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 32px;
            border-top: 1px solid #e5e5e5;
            background: #fafafa;
        }

        .synthetic-disclosure {
            font-size: 0.75rem;
            color: #6b7280;
        }

        .modal-navigation {
            display: flex;
            gap: 12px;
        }

        .nav-button {
            background: white;
            border: 1px solid #d1d5db;
            color: #6b7280;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 150ms ease;
        }

        .nav-button:hover:not(:disabled) {
            background: #f3f4f6;
            border-color: #9ca3af;
        }

        .nav-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .project-modal {
                width: 100vw;
                height: 100vh;
                border-radius: 0;
            }

            .project-modal-content {
                flex-direction: column;
            }

            .project-modal-sidebar {
                width: 100%;
                order: -1;
                max-height: 200px;
            }

            .contents-nav {
                display: flex;
                overflow-x: auto;
                padding: 0 24px;
                gap: 16px;
            }

            .contents-nav li {
                margin-bottom: 0;
                white-space: nowrap;
            }

            .chart-grid {
                grid-template-columns: 1fr;
            }

            .impact-stats {
                grid-template-columns: 1fr;
            }
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .project-section {
            animation: fadeInUp 0.6s ease-out;
        }

        /* Chart Menu Dropdown */
        .chart-menu-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border: 1px solid #e5e5e5;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 8px 0;
            min-width: 140px;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-8px);
            transition: all 150ms ease;
        }

        .chart-menu-dropdown.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .chart-menu-item {
            padding: 8px 16px;
            font-size: 0.875rem;
            color: #4b5563;
            cursor: pointer;
            transition: background 150ms ease;
        }

        .chart-menu-item:hover {
            background: #f3f4f6;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #6b7280;
        }

        .empty-state-title {
            font-size: 1.125rem;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .empty-state-message {
            font-size: 0.875rem;
            margin-bottom: 16px;
        }

        .reset-button {
            background: #1a1a1a;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: background 150ms ease;
        }

        .reset-button:hover {
            background: #374151;
        }

        /* Micro-sparkline */
        .micro-sparkline {
            height: 20px;
            width: 60px;
            margin-left: 8px;
        }

        /* Data dictionary styling */
        .data-dictionary {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 16px;
            margin: 16px 0;
        }

        .data-dictionary-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 12px;
        }

        .data-dictionary-item {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            color: #6b7280;
            margin-bottom: 6px;
        }

        .data-dictionary-item:last-child {
            margin-bottom: 0;
        }

        .variable-name {
            font-family: 'SÃ¶hne Mono', monospace;
            color: #374151;
        }
    </style>
</head>
<body>

    <!-- Project Modal Structure -->
    <div id="project-modal-overlay" class="project-modal-overlay" role="dialog" aria-labelledby="project-modal-title" aria-hidden="true">
        <div class="project-modal">
            <!-- Header -->
            <div class="project-modal-header">
                <div>
                    <h1 id="project-modal-title" class="project-modal-title">Commercial Real Estate Analytics</h1>
                    <div class="project-modal-badges">
                        <span class="project-badge scenario" id="current-scenario">Base</span>
                        <span class="project-badge synthetic">Synthetic</span>
                    </div>
                </div>
                <button class="project-modal-close" aria-label="Close project details" id="project-modal-close">Ã</button>
            </div>

            <!-- Main Content -->
            <div class="project-modal-content">
                <!-- Left Column - Narrative -->
                <div class="project-modal-main">
                    <!-- Overview -->
                    <section class="project-section" id="overview">
                        <h2 class="project-section-title">Overview</h2>
                        <div class="project-section-content" id="project-overview">
                            Built comprehensive DCF models and cash flow forecasts for commercial real estate evaluations, redesigning database infrastructure for enhanced analytical efficiency and portfolio optimization.
                        </div>
                    </section>

                    <!-- Methods & Data -->
                    <section class="project-section" id="methods">
                        <h2 class="project-section-title">Methods & Data</h2>
                        <div class="project-section-content">
                            <ul id="project-methods">
                                <li>Developed multi-scenario DCF models with sensitivity analysis</li>
                                <li>Integrated market data feeds and cap rate benchmarking</li>
                                <li>Built automated cash flow forecasting with lease rollover modeling</li>
                                <li>Implemented risk-adjusted return calculations</li>
                                <li>Created database optimization for 10K+ property records</li>
                            </ul>
                            
                            <div class="data-dictionary">
                                <div class="data-dictionary-title">Data Dictionary</div>
                                <div class="data-dictionary-item">
                                    <span class="variable-name">noi_margin</span>
                                    <span>Net Operating Income / Gross Revenue (%)</span>
                                </div>
                                <div class="data-dictionary-item">
                                    <span class="variable-name">cap_rate</span>
                                    <span>Capitalization Rate (% annual)</span>
                                </div>
                                <div class="data-dictionary-item">
                                    <span class="variable-name">irr</span>
                                    <span>Internal Rate of Return (% annual)</span>
                                </div>
                                <div class="data-dictionary-item">
                                    <span class="variable-name">sample_window</span>
                                    <span>Q1 2023 - Q4 2024 (24 months)</span>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Results -->
                    <section class="project-section" id="results">
                        <h2 class="project-section-title">Results</h2>
                        <div class="project-section-content">
                            <div class="chart-grid">
                                <!-- Chart 1: DCF Waterfall -->
                                <div class="chart-tile">
                                    <div class="chart-header">
                                        <div class="chart-title">DCF to Equity Â· $ Millions (Base)</div>
                                        <button class="chart-menu" onclick="toggleChartMenu(this)">â¢â¢â¢</button>
                                        <div class="chart-menu-dropdown">
                                            <div class="chart-menu-item" onclick="downloadChart('dcf-waterfall', 'png')">Download PNG</div>
                                            <div class="chart-menu-item" onclick="downloadChart('dcf-waterfall', 'csv')">Download CSV</div>
                                        </div>
                                    </div>
                                    <div class="chart-container">
                                        <canvas id="dcf-waterfall-chart"></canvas>
                                    </div>
                                    <div class="chart-takeaway">
                                        Property value driven primarily by NOI optimization; cap rate sensitivity creates Â±$2.1M range.
                                    </div>
                                </div>

                                <!-- Chart 2: IRR Sensitivity -->
                                <div class="chart-tile">
                                    <div class="chart-header">
                                        <div class="chart-title">IRR vs Discount Rate Â· % Annual</div>
                                        <button class="chart-menu" onclick="toggleChartMenu(this)">â¢â¢â¢</button>
                                        <div class="chart-menu-dropdown">
                                            <div class="chart-menu-item" onclick="downloadChart('irr-sensitivity', 'png')">Download PNG</div>
                                            <div class="chart-menu-item" onclick="downloadChart('irr-sensitivity', 'csv')">Download CSV</div>
                                        </div>
                                    </div>
                                    <div class="chart-container">
                                        <canvas id="irr-sensitivity-chart"></canvas>
                                    </div>
                                    <div class="chart-takeaway">
                                        IRR is most sensitive to exit cap; +50bps â IRR â 110bps in base scenario.
                                    </div>
                                </div>

                                <!-- Chart 3: Risk-Return Bubble -->
                                <div class="chart-tile">
                                    <div class="chart-header">
                                        <div class="chart-title">Cap Rate vs NOI Margin Â· Bubble Size = Property Value</div>
                                        <button class="chart-menu" onclick="toggleChartMenu(this)">â¢â¢â¢</button>
                                        <div class="chart-menu-dropdown">
                                            <div class="chart-menu-item" onclick="downloadChart('risk-return', 'png')">Download PNG</div>
                                            <div class="chart-menu-item" onclick="downloadChart('risk-return', 'csv')">Download CSV</div>
                                        </div>
                                    </div>
                                    <div class="chart-container">
                                        <canvas id="risk-return-chart"></canvas>
                                    </div>
                                    <div class="chart-takeaway">
                                        Portfolio positioned in attractive risk-return quadrant with 6.8% cap rates and 74% NOI margins.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Impact -->
                    <section class="project-section" id="impact">
                        <h2 class="project-section-title">Impact</h2>
                        <div class="project-section-content">
                            <div class="impact-stats">
                                <div class="impact-stat">
                                    <div class="impact-stat-value">18.4%</div>
                                    <div class="impact-stat-label">IRR Improvement</div>
                                </div>
                                <div class="impact-stat">
                                    <div class="impact-stat-value">$4.2M</div>
                                    <div class="impact-stat-label">Value Creation</div>
                                </div>
                                <div class="impact-stat">
                                    <div class="impact-stat-value">67%</div>
                                    <div class="impact-stat-label">Analysis Speed</div>
                                </div>
                            </div>
                            <p>Redesigned analytical framework increased portfolio decision speed by 67% while improving risk-adjusted returns through enhanced scenario modeling and automated sensitivity analysis.</p>
                        </div>
                    </section>

                    <!-- Risks & Limitations -->
                    <section class="project-section" id="risks">
                        <h2 class="project-section-title">Risks & Sensitivities</h2>
                        <div class="project-section-content">
                            <ul>
                                <li>Market cap rate assumptions subject to interest rate volatility</li>
                                <li>Lease rollover timing affects cash flow predictability</li>
                                <li>Construction cost inflation impacts development scenarios</li>
                                <li>Local market dynamics not fully captured in regional models</li>
                            </ul>
                        </div>
                    </section>

                    <!-- Artifacts -->
                    <section class="project-section" id="artifacts">
                        <h2 class="project-section-title">Artifacts</h2>
                        <div class="project-section-content">
                            <div class="attachments-grid" id="project-attachments">
                                <!-- Attachments will be populated by JavaScript -->
                            </div>
                        </div>
                    </section>
                </div>

                <!-- Right Sidebar -->
                <div class="project-modal-sidebar">
                    <!-- Contents -->
                    <div class="sidebar-section">
                        <div class="sidebar-title">Contents</div>
                        <ul class="contents-nav">
                            <li><a href="#overview" class="nav-link">Overview</a></li>
                            <li><a href="#methods" class="nav-link">Methods</a></li>
                            <li><a href="#results" class="nav-link">Results</a></li>
                            <li><a href="#impact" class="nav-link">Impact</a></li>
                            <li><a href="#risks" class="nav-link">Risks</a></li>
                            <li><a href="#artifacts" class="nav-link">Artifacts</a></li>
                        </ul>
                    </div>

                    <!-- Quick Facts -->
                    <div class="sidebar-section">
                        <div class="sidebar-title">Quick Facts</div>
                        <div class="quick-facts" id="project-quick-facts">
                            <div class="quick-fact">
                                <span class="quick-fact-label">Duration</span>
                                <span class="quick-fact-value">8 months</span>
                            </div>
                            <div class="quick-fact">
                                <span class="quick-fact-label">Portfolio Size</span>
                                <span class="quick-fact-value">$45M AUM</span>
                            </div>
                            <div class="quick-fact">
                                <span class="quick-fact-label">Properties</span>
                                <span class="quick-fact-value">12 assets</span>
                            </div>
                            <div class="quick-fact">
                                <span class="quick-fact-label">Team Size</span>
                                <span class="quick-fact-value">4 analysts</span>
                            </div>
                        </div>
                    </div>

                    <!-- Assumptions & Controls -->
                    <div class="sidebar-section">
                        <div class="sidebar-title">Assumptions & Controls</div>
                        <div class="scenario-controls">
                            <div class="scenario-chips">
                                <button class="scenario-chip active" data-scenario="base">Base</button>
                                <button class="scenario-chip" data-scenario="bull">Bull</button>
                                <button class="scenario-chip" data-scenario="bear">Bear</button>
                            </div>
                            <div class="parameter-control">
                                <label class="parameter-label">Discount Rate: <span id="discount-rate-value">8.5%</span></label>
                                <input type="range" class="parameter-slider" id="discount-rate" min="6" max="12" step="0.5" value="8.5">
                            </div>
                        </div>
                    </div>

                    <!-- Key Metrics -->
                    <div class="sidebar-section">
                        <div class="sidebar-title">Key Metrics</div>
                        <div class="quick-facts">
                            <div class="quick-fact">
                                <span class="quick-fact-label">Current IRR</span>
                                <span class="quick-fact-value">14.8%</span>
                            </div>
                            <div class="quick-fact">
                                <span class="quick-fact-label">Cap Rate</span>
                                <span class="quick-fact-value">6.8%</span>
                            </div>
                            <div class="quick-fact">
                                <span class="quick-fact-label">NOI Margin</span>
                                <span class="quick-fact-value">74%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Attachments -->
                    <div class="sidebar-section">
                        <div class="sidebar-title">Attachments</div>
                        <div class="attachments-grid">
                            <div class="attachment-item" onclick="openAttachment('dcf-model.pdf')">
                                <div class="attachment-icon">ð</div>
                                <div class="attachment-info">
                                    <div class="attachment-name">DCF Model.pdf</div>
                                    <div class="attachment-meta">2.3 MB â¢ Updated Dec 15</div>
                                </div>
                            </div>
                            <div class="attachment-item" onclick="openAttachment('market-data.csv')">
                                <div class="attachment-icon">ð</div>
                                <div class="attachment-info">
                                    <div class="attachment-name">market-data.csv</div>
                                    <div class="attachment-meta">156 KB â¢ Updated Dec 10</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="project-modal-footer">
                <div class="synthetic-disclosure">
                    Charts and numbers are synthetic for portfolio demonstration.
                </div>
                <div class="modal-navigation">
                    <button class="nav-button" id="prev-project">â Previous</button>
                    <button class="nav-button" id="next-project">Next â</button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript for Project Modal System -->
    <script>
        class ProjectModalSystem {
            constructor() {
                this.currentProject = null;
                this.currentScenario = 'base';
                this.charts = {};
                this.projects = this.getProjectData();
                this.init();
            }

            init() {
                this.bindEvents();
                this.initScrollSpy();
            }

            bindEvents() {
                // Close modal
                document.getElementById('project-modal-close').addEventListener('click', () => this.closeModal());
                document.getElementById('project-modal-overlay').addEventListener('click', (e) => {
                    if (e.target === e.currentTarget) this.closeModal();
                });

                // Keyboard navigation
                document.addEventListener('keydown', (e) => {
                    if (document.getElementById('project-modal-overlay').classList.contains('active')) {
                        if (e.key === 'Escape') this.closeModal();
                        if (e.key === 'ArrowLeft') this.navigateProject('prev');
                        if (e.key === 'ArrowRight') this.navigateProject('next');
                    }
                });

                // Scenario controls
                document.querySelectorAll('.scenario-chip').forEach(chip => {
                    chip.addEventListener('click', (e) => this.changeScenario(e.target.dataset.scenario));
                });

                // Parameter controls
                document.getElementById('discount-rate').addEventListener('input', (e) => {
                    document.getElementById('discount-rate-value').textContent = `${e.target.value}%`;
                    this.updateCharts();
                });

                // Navigation
                document.getElementById('prev-project').addEventListener('click', () => this.navigateProject('prev'));
                document.getElementById('next-project').addEventListener('click', () => this.navigateProject('next'));

                // Contents navigation
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const targetId = e.target.getAttribute('href').substring(1);
                        document.getElementById(targetId).scrollIntoView({ behavior: 'smooth' });
                    });
                });
            }

            openModal(projectId) {
                this.currentProject = this.projects[projectId];
                if (!this.currentProject) return;

                this.populateModal();
                this.createCharts();
                
                const overlay = document.getElementById('project-modal-overlay');
                overlay.classList.add('active');
                overlay.setAttribute('aria-hidden', 'false');
                document.body.style.overflow = 'hidden';

                // Update URL
                history.pushState({ projectId }, '', `#project-${projectId}`);
            }

            closeModal() {
                const overlay = document.getElementById('project-modal-overlay');
                overlay.classList.remove('active');
                overlay.setAttribute('aria-hidden', 'true');
                document.body.style.overflow = '';

                // Clean up charts
                Object.values(this.charts).forEach(chart => {
                    if (chart) chart.destroy();
                });
                this.charts = {};

                // Update URL
                history.pushState({}, '', window.location.pathname);
            }

            populateModal() {
                const project = this.currentProject;
                
                // Update title and badges
                document.getElementById('project-modal-title').textContent = project.title;
                
                // Update content sections
                document.getElementById('project-overview').textContent = project.overview;
                
                // Update methods
                const methodsList = document.getElementById('project-methods');
                methodsList.innerHTML = project.methods.map(method => `<li>${method}</li>`).join('');
                
                // Update quick facts
                const quickFacts = document.getElementById('project-quick-facts');
                quickFacts.innerHTML = Object.entries(project.quickFacts)
                    .map(([label, value]) => `
                        <div class="quick-fact">
                            <span class="quick-fact-label">${label}</span>
                            <span class="quick-fact-value">${value}</span>
                        </div>
                    `).join('');

                // Update attachments
                const attachments = document.getElementById('project-attachments');
                attachments.innerHTML = project.attachments.map(att => `
                    <div class="attachment-item" onclick="openAttachment('${att.file}')">
                        <div class="attachment-icon">${att.icon}</div>
                        <div class="attachment-info">
                            <div class="attachment-name">${att.name}</div>
                            <div class="attachment-meta">${att.meta}</div>
                        </div>
                    </div>
                `).join('');
            }

            changeScenario(scenario) {
                this.currentScenario = scenario;
                
                // Update active state
                document.querySelectorAll('.scenario-chip').forEach(chip => {
                    chip.classList.toggle('active', chip.dataset.scenario === scenario);
                });
                
                // Update badge
                document.getElementById('current-scenario').textContent = 
                    scenario.charAt(0).toUpperCase() + scenario.slice(1);
                
                // Update charts
                this.updateCharts();
            }

            createCharts() {
                this.createDCFWaterfallChart();
                this.createIRRSensitivityChart();
                this.createRiskReturnChart();
            }

            createDCFWaterfallChart() {
                const ctx = document.getElementById('dcf-waterfall-chart').getContext('2d');
                this.charts.dcfWaterfall = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Purchase', 'NOI Growth', 'CapEx', 'Exit Value', 'Equity Return'],
                        datasets: [{
                            data: [12.5, 3.2, -1.1, 8.4, 23.0],
                            backgroundColor: ['#6b7280', '#d97706', '#dc2626', '#059669', '#1f2937'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: { color: '#f3f4f6' },
                                ticks: { 
                                    font: { family: 'SÃ¶hne Mono, monospace', size: 10 },
                                    callback: value => `$${value}M`
                                }
                            },
                            x: {
                                grid: { display: false },
                                ticks: { font: { family: 'SÃ¶hne Mono, monospace', size: 10 } }
                            }
                        },
                        animation: {
                            duration: 800,
                            easing: 'easeOutQuart'
                        }
                    }
                });
            }

            createIRRSensitivityChart() {
                const ctx = document.getElementById('irr-sensitivity-chart').getContext('2d');
                this.charts.irrSensitivity = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['6%', '7%', '8%', '9%', '10%', '11%', '12%'],
                        datasets: [{
                            label: 'IRR',
                            data: [16.8, 15.9, 14.8, 13.6, 12.3, 10.9, 9.4],
                            borderColor: '#d97706',
                            backgroundColor: 'rgba(217, 119, 6, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                grid: { color: '#f3f4f6' },
                                ticks: { 
                                    font: { family: 'SÃ¶hne Mono, monospace', size: 10 },
                                    callback: value => `${value}%`
                                }
                            },
                            x: {
                                grid: { display: false },
                                ticks: { font: { family: 'SÃ¶hne Mono, monospace', size: 10 } }
                            }
                        },
                        animation: {
                            duration: 800,
                            easing: 'easeOutQuart'
                        }
                    }
                });
            }

            createRiskReturnChart() {
                const ctx = document.getElementById('risk-return-chart').getContext('2d');
                this.charts.riskReturn = new Chart(ctx, {
                    type: 'scatter',
                    data: {
                        datasets: [{
                            label: 'Properties',
                            data: [
                                {x: 6.8, y: 74, r: 15},
                                {x: 7.2, y: 68, r: 10},
                                {x: 6.5, y: 78, r: 12},
                                {x: 7.5, y: 65, r: 8},
                                {x: 6.9, y: 72, r: 11}
                            ],
                            backgroundColor: 'rgba(217, 119, 6, 0.6)',
                            borderColor: '#d97706',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                title: { display: true, text: 'NOI Margin (%)' },
                                grid: { color: '#f3f4f6' },
                                ticks: { font: { family: 'SÃ¶hne Mono, monospace', size: 10 } }
                            },
                            x: {
                                title: { display: true, text: 'Cap Rate (%)' },
                                grid: { color: '#f3f4f6' },
                                ticks: { font: { family: 'SÃ¶hne Mono, monospace', size: 10 } }
                            }
                        },
                        animation: {
                            duration: 800,
                            easing: 'easeOutQuart'
                        }
                    }
                });
            }

            updateCharts() {
                // Simulate data updates based on scenario and parameters
                const scenario = this.currentScenario;
                const discountRate = parseFloat(document.getElementById('discount-rate').value);
                
                // Update chart data based on scenario
                Object.values(this.charts).forEach(chart => {
                    if (chart) chart.update('none');
                });
            }

            navigateProject(direction) {
                const projectIds = Object.keys(this.projects);
                const currentIndex = projectIds.indexOf(this.currentProject.id);
                let newIndex;
                
                if (direction === 'prev') {
                    newIndex = currentIndex > 0 ? currentIndex - 1 : projectIds.length - 1;
                } else {
                    newIndex = currentIndex < projectIds.length - 1 ? currentIndex + 1 : 0;
                }
                
                this.openModal(projectIds[newIndex]);
            }

            initScrollSpy() {
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const id = entry.target.id;
                            document.querySelectorAll('.nav-link').forEach(link => {
                                link.classList.toggle('active', link.getAttribute('href') === `#${id}`);
                            });
                        }
                    });
                }, { rootMargin: '-50% 0px -50% 0px' });

                document.querySelectorAll('.project-section').forEach(section => {
                    observer.observe(section);
                });
            }

            getProjectData() {
                return {
                    'commercial-real-estate': {
                        id: 'commercial-real-estate',
                        title: 'Commercial Real Estate Analytics',
                        overview: 'Built comprehensive DCF models and cash flow forecasts for commercial real estate evaluations, redesigning database infrastructure for enhanced analytical efficiency and portfolio optimization.',
                        methods: [
                            'Developed multi-scenario DCF models with sensitivity analysis',
                            'Integrated market data feeds and cap rate benchmarking',
                            'Built automated cash flow forecasting with lease rollover modeling',
                            'Implemented risk-adjusted return calculations',
                            'Created database optimization for 10K+ property records'
                        ],
                        quickFacts: {
                            'Duration': '8 months',
                            'Portfolio Size': '$45M AUM',
                            'Properties': '12 assets',
                            'Team Size': '4 analysts'
                        },
                        attachments: [
                            { icon: 'ð', name: 'DCF Model.pdf', meta: '2.3 MB â¢ Updated Dec 15', file: 'dcf-model.pdf' },
                            { icon: 'ð', name: 'market-data.csv', meta: '156 KB â¢ Updated Dec 10', file: 'market-data.csv' }
                        ]
                    },
                    'blockchain-cofounder': {
                        id: 'blockchain-cofounder',
                        title: 'Blockchain Protocol Development',
                        overview: 'Architected innovative blockchain project on Bittensor protocol, secured $10K DormDAO grant for decentralized governance initiatives with focus on scalability and consensus mechanisms.',
                        methods: [
                            'Designed consensus algorithm for 1000+ TPS throughput',
                            'Implemented smart contract architecture with gas optimization',
                            'Built validator network with economic incentive structures',
                            'Created governance token with utility-based economics',
                            'Developed stress testing framework for network performance'
                        ],
                        quickFacts: {
                            'Duration': '6 months',
                            'Grant Amount': '$10K',
                            'Network TPS': '1,200',
                            'Validators': '150+'
                        },
                        attachments: [
                            { icon: 'â¡', name: 'Protocol Whitepaper.pdf', meta: '1.8 MB â¢ Updated Nov 28', file: 'whitepaper.pdf' },
                            { icon: 'ð¾', name: 'smart-contracts.sol', meta: '89 KB â¢ Updated Dec 5', file: 'contracts.sol' }
                        ]
                    },
                    'energy-trading': {
                        id: 'energy-trading',
                        title: 'Energy Commodities Trading',
                        overview: 'Advanced energy commodities analysis and algorithmic trading strategies development at UTEXAS Energy Trading cohort program focusing on volatility modeling and risk management.',
                        methods: [
                            'Built volatility forecasting models using GARCH methodology',
                            'Developed mean-reversion trading strategies for natural gas',
                            'Implemented real-time risk monitoring with VaR calculations',
                            'Created automated execution system with latency optimization',
                            'Analyzed seasonal patterns and weather derivative impacts'
                        ],
                        quickFacts: {
                            'Duration': '4 months',
                            'Strategies': '6 algorithms',
                            'Max Drawdown': '2.8%',
                            'Sharpe Ratio': '1.84'
                        },
                        attachments: [
                            { icon: 'ð', name: 'Trading Strategy.pdf', meta: '2.1 MB â¢ Updated Oct 15', file: 'strategy.pdf' },
                            { icon: 'ð', name: 'backtest-results.xlsx', meta: '445 KB â¢ Updated Oct 20', file: 'backtest.xlsx' }
                        ]
                    }
                };
            }
        }

        // Global functions for external calls
        function toggleChartMenu(button) {
            const dropdown = button.nextElementSibling;
            dropdown.classList.toggle('active');
            
            // Close other dropdowns
            document.querySelectorAll('.chart-menu-dropdown').forEach(dd => {
                if (dd !== dropdown) dd.classList.remove('active');
            });
        }

        function downloadChart(chartId, format) {
            // Implement download functionality
            console.log(`Downloading ${chartId} as ${format}`);
            // Close dropdown
            document.querySelectorAll('.chart-menu-dropdown').forEach(dd => {
                dd.classList.remove('active');
            });
        }

        function openAttachment(filename) {
            // Implement attachment viewer
            console.log(`Opening attachment: ${filename}`);
        }

        // Initialize the system
        const projectModalSystem = new ProjectModalSystem();

        // Make openProjectModal globally available
        window.openProjectModal = (projectId) => projectModalSystem.openModal(projectId);

        // Handle browser back/forward
        window.addEventListener('popstate', (e) => {
            if (e.state && e.state.projectId) {
                projectModalSystem.openModal(e.state.projectId);
            } else {
                projectModalSystem.closeModal();
            }
        });
    </script>

</body>
</html>
